<?xml version="1.0" encoding="utf-8"?>
<mx:Application 
		xmlns:mx="http://www.adobe.com/2006/mxml" 
		xmlns:services="org.luchini.weightcontrol.controller.delegates.*"
		xmlns:controller="org.luchini.weightcontrol.controller.*"
		layout="absolute">

	<services:Services id="services"/>
	<controller:Controller id="controller"/>

	<mx:RemoteObject 
		id="accountService2"
		destination="rubyamf"
		endpoint="http://localhost:3000/rubyamf_gateway"
		source="AccountController"
		showBusyCursor="true"
		result="result(event)"
		fault="fault(event)"/>

	<mx:Script>
		<![CDATA[
			import mx.rpc.events.FaultEvent;
			import com.adobe.cairngorm.business.ServiceLocator;
			import com.adobe.cairngorm.control.CairngormEventDispatcher;
			import org.luchini.weightcontrol.events.AccountEvent;
			import org.luchini.weightcontrol.model.vo.User;
			import org.luchini.weightcontrol.model.WeightControlModelLocator;
			import mx.rpc.events.ResultEvent;
			import mx.controls.Alert;
			import mx.rpc.AsyncToken;

			private function result(event:ResultEvent):void {
				Alert.show("Resultado legal: " + event.result.toString());
			}
			
			private function fault(event:FaultEvent):void {
				Alert.show("Fault: " + event.fault.faultString);
			}
			
			private function loginClick():void {
				/*ServiceLocator.getInstance().setRemoteCredentials("usususususu", "papapapapap");
				var event:AccountEvent = new AccountEvent(AccountEvent.LOGIN);
				event.login = "tiagoluchini";
				event.password = "pimpao";
				CairngormEventDispatcher.getInstance().dispatchEvent(event);*/
				accountService2.user_login();
			}
						
			private function setarClick():void {
				accountService2.setRemoteCredentials(txtUser.text, txtPass.text);
				Alert.show("Setado");
			}
			
			private function logoffClick():void {
				accountService2.user_logout();
			}
			
		]]>
	</mx:Script>
	
	<mx:Canvas>
		<mx:HBox>
			<mx:Button label="Login" click="loginClick()"/>
			<mx:TextInput id="txtUser" text="gambi_user"/>
			<mx:TextInput id="txtPass" text="gambi_pass"/>
			<mx:Button label="Setar" click="setarClick()"/>
			<mx:Button label="Logoff" click="logoffClick()"/>
			<mx:Label text="{WeightControlModelLocator.getInstance().user.email}"/>	
		</mx:HBox>
	</mx:Canvas>
	
</mx:Application>
